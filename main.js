(()=>{"use strict";var e,t={baseUrl:"https://nomoreparties.co/v1/apf-cohort-202",headers:{authorization:"b27f8ef8-b6db-412d-b6ac-dca73d415e99","Content-Type":"application/json"}},n=function(){return fetch("".concat(t.baseUrl,"/cards"),{headers:{authorization:t.headers.authorization}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка:  ".concat(e.status))}))},o=function(){return fetch("".concat(t.baseUrl,"/users/me"),{headers:{authorization:t.headers.authorization}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка:  ".concat(e.status))}))},r=document.querySelector(".popup_type_image"),c=document.querySelector("#card-template").content.querySelector(".card"),a=r.querySelector(".popup__image"),i=r.querySelector(".popup__caption");function u(e,n,o){var u=c.cloneNode(!0),s=u.querySelector(".card__title"),l=u.querySelector(".card__image"),d=u.querySelector(".card__like-count"),p=u.querySelector(".card__delete-button"),f=e.likes.some((function(e){return e._id===n})),_=u.querySelector(".card__like-button");return s.textContent=e.name,l.src=e.link,l.alt="картинка",d.textContent=e.likes?e.likes.length:0,f&&_.classList.add("card__like-button_is-active"),e.owner._id!==n?p.style.display="none":p.addEventListener("click",(function(n){!function(e,n){(function(e){return fetch("".concat(t.baseUrl,"/cards/").concat(e._id),{method:"DELETE",headers:{authorization:t.headers.authorization}})})(n).then((function(t){if(!t.ok)return Promise.reject("Ошибка:  ".concat(t.status));e.target.closest(".card").remove()})).catch((function(e){console.log(e)}))}(n,e)})),function(e,n,o){e.addEventListener("click",(function(e){e.target.classList.contains("card__like-button_is-active")?function(e){return fetch("".concat(t.baseUrl,"/cards/likes/").concat(e._id),{method:"DELETE",headers:{authorization:t.headers.authorization}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка:  ".concat(e.status))}))}(n).then((function(t){o.textContent=t.likes.length,e.target.classList.remove("card__like-button_is-active")})).catch((function(e){console.log(e)})):function(e){return fetch("".concat(t.baseUrl,"/cards/likes/").concat(e._id),{method:"PUT",headers:{authorization:t.headers.authorization}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка:  ".concat(e.status))}))}(n).then((function(t){console.log(t),o.textContent=t.likes.length,e.target.classList.add("card__like-button_is-active")})).catch((function(e){console.log(e)}))}))}(_,e,d),l.addEventListener("click",(function(t){a.src=t.target.src,i.textContent=e.name,o(r)})),u}function s(t){t.classList.add("popup_is-opened"),e=function(e){return function(e,t){e.currentTarget===e.target&&l(t)}(e,t)},t.addEventListener("mousedown",e),document.addEventListener("keydown",d)}function l(t){t.classList.remove("popup_is-opened"),t.removeEventListener("click",e),document.removeEventListener("keydown",d)}function d(e){"Escape"===e.key&&l(document.querySelector(".popup_is-opened"))}var p,f=function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(n.inactiveButtonClass),t.removeAttribute("disabled")):(t.classList.add(n.inactiveButtonClass),t.setAttribute("disabled",!0))},_="796e9005914fa8a4f00ab4ad",h=document.querySelector(".popup_type_edit"),m=document.querySelector(".popup_type_new-card"),v=document.querySelector(".popup_type_change-avatar"),y=h.querySelector(".popup__button"),S=m.querySelector(".popup__button"),b=v.querySelector(".popup__button"),q=v.querySelector(".popup__input_type_avtar"),k=v.querySelector('[name="change-avatar"]'),g=document.querySelector(".profile__edit-button"),C=document.querySelector(".profile__image"),L=document.querySelector(".profile__title"),E=document.querySelector(".profile__description"),x=h.querySelector('[name="edit-profile"]'),j=h.querySelector(".popup__input_type_name"),P=h.querySelector(".popup__input_type_description"),z=document.querySelector(".profile__add-button"),U=m.querySelector('[name="new-place"]'),A=m.querySelector(".popup__input_type_card-name"),T=m.querySelector(".popup__input_type_url"),w=[h,m,v,r];C.addEventListener("click",(function(){s(v)})),k.addEventListener("submit",(function(e){var n;e.preventDefault(),b.textContent="Сохранение...",(n=q.value,fetch("".concat(t.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:t.headers,body:JSON.stringify({avatar:n})})).then((function(e){if(!e.ok)return Promise.reject("Ошибка:  ".concat(e.status));C.style="background-image: url('".concat(q.value,"');"),l(v)})).catch((function(e){console.log(e)})).finally((function(){b.textContent="Сохранить"}))})),o().then((function(e){C.style="background-image: url('".concat(e.avatar,"');"),q.value=e.avatar,L.textContent=e.name,E.textContent=e.about})).catch((function(e){console.log(e)})),p={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"button_inactive",inputErrorClass:"popup__input_type_error",errorClass:"form__input-error_active"},Array.from(document.querySelectorAll(p.formSelector)).forEach((function(e){!function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);f(n,o,t),n.forEach((function(r){r.addEventListener("input",(function(){f(n,o,t),function(e,t,n){t.validity.valid?function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent=""}(e,t,n):function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o.inputErrorClass),r.classList.add(o.errorClass),r.textContent=n}(e,t,t.validationMessage,n)}(e,r,t)}))}))}(e,p)})),w.forEach((function(e){var t;e.classList.add("popup_is-animated"),(t=e).querySelector(".popup__close").addEventListener("click",(function(){l(t)}))}));var B=document.querySelector(".places__list");n().then((function(e){e.forEach((function(e){B.append(u(e,_,s))}))})).catch((function(e){console.log(e)})),Promise.all(o,n).catch((function(e){console.log(e)})),g.addEventListener("click",(function(){!function(e,t,n,o){e.value=n.textContent,t.value=o.textContent}(j,P,L,E),s(h)})),x.addEventListener("submit",(function(e){var n,o;e.preventDefault(),y.textContent="Сохранение...",(n=j.value,o=P.value,fetch("".concat(t.baseUrl,"/users/me"),{method:"PATCH",headers:t.headers,body:JSON.stringify({name:n,about:o})})).then((function(e){if(!e.ok)return Promise.reject("Ошибка:  ".concat(e.status));L.textContent=j.value,E.textContent=P.value,l(h)})).catch((function(e){console.log(e)})).finally((function(){y.textContent="Сохранить"}))})),z.addEventListener("click",(function(){s(m)})),U.addEventListener("submit",(function(e){var n,o;e.preventDefault(),S.textContent="Сохранение...",(n=A.value,o=T.value,fetch("".concat(t.baseUrl,"/cards"),{method:"POST",headers:t.headers,body:JSON.stringify({name:n,link:o})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка:  ".concat(e.status))}))).then((function(e){console.log(e),B.prepend(u(e,_,s)),l(m)})).catch((function(e){console.log(e)})).finally((function(){S.textContent="Сохранить"}))}))})();